{% load static %}{% get_static_prefix as STATIC_PREFIX %}<!DOCTYPE HTML>
<html>
<head>
<title>Task Entries</title>

<!-- CSS imports -->
<link rel="stylesheet" type="text/css" href="{{STATIC_PREFIX}}resources/css/list.css" />
<link rel="stylesheet" type="text/css" href="{{STATIC_PREFIX}}resources/css/bmi.css" />
<link rel='stylesheet' type='text/css' href="{{STATIC_PREFIX}}resources/css/jquery-ui.css" />


<!-- JS imports -->
<script src='{{ STATIC_PREFIX }}resources/js/jquery.min.js' type='text/javascript'></script>
<script src='{{ STATIC_PREFIX }}resources/js/jquery-ui.min.js' type='text/javascript'></script>
<script src='{{ STATIC_PREFIX }}resources/js/parse_traits.js' type='text/javascript'></script>
<script src='{{ STATIC_PREFIX }}resources/js/list.js' type='text/javascript'></script>
<script src='{{ STATIC_PREFIX }}resources/js/sequence.js' type='text/javascript'></script>
<script src='{{ STATIC_PREFIX }}resources/js/report.js' type='text/javascript'></script>
<script src='{{ STATIC_PREFIX }}resources/js/bmi.js' type='text/javascript'></script>
<script type='text/javascript'>
	var hostname = "{{hostname}}";
	var te = null;
	$(document).ready(function() {
		$("table#main tr").each(function() {
			// Register a click callback for each row of the 'main' table
			// If you click on the very top row, the id is set to "newentry" 
			// so it knows to create a "blank" TaskEntry
			// Otherwise, the row will have an 'id' of format 'row\d\d\d\d'
			$(this).click(function() {
				te = new TaskEntry(this.id == "newentry" ? null : this.id);
			});
		});

		var taskaction = "run";

		$("#copybtn").click(TaskEntry.copy); // run the TaskEntry prototype copy function to make new parameters

		// $("#hidebtn").click(
		// 	function() {
		// 		console.log("Hiding task entry " + te.idx);
		// 		$.get("/ajax/hide_entry/"+te.idx, 
		// 			{}, 
		// 			function() {
		// 				// console.log('slide');
		// 				// console.log("row" + te.idx);
		// 				$("#row" + te.idx).slideToggle("slow");
		// 				te.destroy();
		// 				// $("#row" + te.idx).hide();
		// 				// console.log($("row" + te.idx))
		// 				// console.log('slide toggle done');
		// 			}
		// 		);
		// 	}
		// );
		// $("#backupbtn").click(function() {$.get("/ajax/backup_entry/"+te.idx)});		
		// $("#unbackupbtn").click(function() {$.get("/ajax/unbackup_entry/"+te.idx)});

		$("#hidebtn").change(
			function () {
				if (this.checked) {
					// TODO
					console.log("Showing task entry " + te.idx);
					$.get("/ajax/show_entry/"+te.idx, 
						{}, 
						function() {
							$("#row" + te.idx).css('background-color', 'white');
						}
					);					
				} else {
					console.log("Hiding task entry " + te.idx);
					$.get("/ajax/hide_entry/"+te.idx, 
						{}, 
						function() {
							$("#row" + te.idx).css('background-color', 'gray');
							te.destroy();
						}
					);
				}
			}
		);


		$("#backupbtn").change(
			function () {
				if (this.checked) {
					$.get("/ajax/backup_entry/"+te.idx);
				} else {
					$.get("/ajax/unbackup_entry/"+te.idx);
				}
			}
		);

		$("#experiment").submit(function() { return te[taskaction](); })
		$("#startbtn").click(function() { taskaction = "start"; })
		$("#testbtn").click(function() { taskaction = "test"; })
		$("#stopbtn").click(function() { taskaction = "stop"; })
		$("#pausebtn").click(function() { taskaction = "pause"; })

		$("#toggle_table").change(
			function() {
				if (this.checked) {
					$('#leftpane').show()
				 	$('#rightpane').css('margin-left', "540px");
				} else {
					$('#leftpane').hide()
					$('#rightpane').css('margin-left', "0px");
				}
			}
		);


		// Clear out dates that are the same
		var table = $('table#main');
		var table_rows = $('#main tr'); // dictionary
		console.log(table_rows);
		for (var row_idx in table_rows) {

			var trow = table_rows[row_idx];
			console.log(typeof(row_idx));
			console.log(typeof(trow));
		}
		// var rowCount = .length;
		// for (var row in $('#main tr')) {
		// 	console.log(row);
		// }
		// console.log();
	})
</script>
</head>

<body>
	<input id="toggle_table" type="checkbox" checked="on" name="hist_checkbox"><span class="checkboxtext">Show History</span><br>
	<div id="main_box">
		<div id='leftpane'>
			{{ n_blocks }} saved task entry records shown below
	        <hr>
			<table id='main' style="direction:ltr;">
				<thead>
				<tr>
					<th>Date</th>
					<th>Time</th>
					<th>ID</th>
					<th class='colSubj'>Who</th>
					<th class='colTask'>Task</th>
				</tr>
				</thead>

				<tbody>
					<tr id='newentry' class='rowactive'>
						<td>Today</td>
						<td>Now</td>
						<td></td> <!-- Empty for database ID slot -->
						<td class='colSubj'>
							<select id='subjects'>
								{% for s in subjects %}<option value='{{s.id}}'>{{ s.name }}</option>
								{% endfor %}
							</select>
						</td>
						<td class='colTask'>
							<select id='tasks'>
								{% for t in tasks %}<option value='{{t.id}}'>{{ t.name }}</option>
								{% endfor %}
							</select>
						</td>
					</tr>
				{% for e in entries %}
					<tr id='row{{e.id}}' {% if e.id == running %} class='running' {% endif %}>
						{% if e.html_date %}
							<td class='colDate firstRowOfday' rowspan={{e.rowspan}}>{{e.html_date}}</td>
							<td class='colTime firstRowOfday' >{{e.html_time}}</td>
							<td class='colID firstRowOfday'   >{{e.id}}</td>
							<td class='colSubj firstRowOfday' >{{e.subject.name}}</td>
							<td class='colTask firstRowOfday' >{{e.task.name}}</td>
						{% else %}
							<td class='colTime' >{{e.html_time}}</td>
							<td class='colID'   >{{e.id}}</td>
							<td class='colSubj' >{{e.subject.name}}</td>
							<td class='colTask' >{{e.task.name}}</td>				
						{% endif %}

					</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>


		<div id="rightpane">
			<div id='content' class="active">
				{% include "exp_content.html" %}
			</div>
		</div>
	</div> <!--main_box-->
</body>
</html>
